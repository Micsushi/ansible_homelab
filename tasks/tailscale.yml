---
# Tailscale - VPN alternative to Wireguard

- name: Create Tailscale directory
  ansible.builtin.file:
    path: "{{ docker_dir }}/tailscale"
    state: directory
    owner: "{{ username }}"
    group: "{{ username }}"
    mode: "0755"

- name: Create Tailscale container
  community.docker.docker_container:
    name: tailscale
    image: tailscale/tailscale:latest
    state: started
    restart_policy: unless-stopped
    volumes:
      - "{{ docker_dir }}/tailscale:/var/lib/tailscale"
      - /dev/net/tun:/dev/net/tun
    networks:
      - name: homelab
    env:
      TS_AUTHKEY: "{{ tailscale_auth_key | default('') }}"
      TS_STATE_DIR: "/var/lib/tailscale"
      TS_USERSPACE: "false"
    cap_add:
      - NET_ADMIN
      - SYS_MODULE
    sysctls:
      "net.ipv4.ip_forward": "1"
      "net.ipv6.conf.all.forwarding": "1"
